# Diesel setup


### Disclaimer
> The barrel crate is still in an early state of development and should not be considered "stable". 
>
> Old migrations might break because the API was changed. Features might be removed or replaced! **Before 1.0 this crate is not stable and should __not__ be used in production** â€“ just wanted to make that loud and clear :)

---

Using rust migrations (via `barrel`) with `diesel` is really simple. First, you need to add the `barrel-migrations` to the features list for your `diesel` dependency. Note that currently `barrel` only supports postgres databases.


```toml
[dependencies]
diesel = { version = "1.2", features = ["barrel-migrations", "postgres"] }
# ...
```

Also make sure that you installed the `diesel_cli` with the `barrel-migrations` feature flag as well

```bash
~ cargo install diesel_cli --features="barrel-migrations"
```

From this point using `diesel` is very similar to how you normally use it. The only difference is that you should provide a `--type` flag when letting diesel generate a migration for you. Running migrations doesn't change.

```bash
~ diesel migration generate <name> --type="barrel"
~ diesel migration run
```

A migration file generated by diesel will look as follows

```rust
/// Handle up migrations
fn up(migr: &mut Migration) {}

/// Handle down migrations
fn down(migr: &mut Migration) {}
```

The object provided as a function parameter is a mutable `Migration` object which you can operate on. Please refer to  [the docs](https://docs.rs/barrel/0.2.0/barrel/migration/struct.Migration.html) for API specifics.
